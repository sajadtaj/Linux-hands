<div dir='rtl'>
اتصال به **LDAP** یا **OAuth** یکی از مهم‌ترین ابزارها در دنیای زیرساخت و احراز هویت (authentication) است که به ما کمک می‌کند دسترسی کاربران به سیستم‌ها را **متمرکز، ایمن و قابل کنترل** کنیم.

در ادامه، برای سطح مبتدی توضیح کامل و سناریوهای کاربردی ارائه می‌دهم:

---

# 🔐 اتصال به LDAP یا OAuth یعنی چه؟

هر کاربری که می‌خواهد وارد یک سیستم شود، باید **احراز هویت** شود (یعنی یوزرنیم و پسورد بدهد).
حالا دو روش برای این کار وجود دارد:

| روش سنتی                                  | روش مدرن                                                     |
| ----------------------------------------- | ------------------------------------------------------------ |
| هر سیستم یوزر و پسورد خودش را نگه می‌دارد | سیستم‌ها از یک سرویس مرکزی استفاده می‌کنند مثل LDAP یا OAuth |

### ✅ **LDAP (Lightweight Directory Access Protocol)**

* مثل یک دفترچه تلفن مرکزی برای کاربران سازمان است.
* معمولاً در شرکت‌ها برای ورود به سیستم‌ها (مثل ویندوز، سرور، وب‌سایت داخلی) استفاده می‌شود.
* دیتابیس LDAP شامل: نام کاربر، ایمیل، گروه کاری، نقش کاربر و... است.

📌 مشهورترین پیاده‌سازی LDAP:

* **Active Directory (مایکروسافت)**
* **OpenLDAP (لینوکس)**

---

### ✅ **OAuth (Open Authorization)**

* یک روش مدرن برای احراز هویت با کمک سرویس‌های دیگر.
* به‌جای اینکه کاربر مستقیماً در سیستم شما یوزر بسازد، از طریق اکانت گوگل، گیت‌هاب، فیسبوک یا سرویس سازمانی وارد می‌شود.

مثال:

* ورود با حساب Google
* ورود با GitHub به GitLab یا Jenkins
* ورود با Keycloak به Kasm

---

## 🧩 تفاوت LDAP و OAuth

| ویژگی      | LDAP                      | OAuth                      |
| ---------- | ------------------------- | -------------------------- |
| مدل کاری   | دیتابیس کاربر داخلی       | تایید از سیستم خارجی       |
| مناسب برای | سازمان‌ها، محیط داخلی     | سیستم‌های ابری، عمومی      |
| نوع اتصال  | مستقیم با دیتابیس کاربران | انتقال توکن از سرویس تایید |
| پروتکل     | LDAP                      | OAuth 2.0، OpenID Connect  |

---

# 💡 سناریوهای واقعی استفاده (مبتدی)

### 1. اتصال Kasm به LDAP

شرکتی دارد ۵۰ کارمند که از Active Directory استفاده می‌کنند.
Kasm را نصب کرده و نمی‌خواهد دوباره برای هر کارمند کاربر جدید تعریف کند.
با اتصال به LDAP، کاربران با همان یوزرنیم/پسورد سازمانی وارد Kasm می‌شوند.

✅ نتیجه: مدیریت متمرکز، ورود راحت، امنیت بیشتر.

---

### 2. اتصال سیستم گزارش‌گیری یا اپلیکیشن به OAuth (مثلاً Google)

یک اپ گزارش‌گیری داری که کاربران زیادی دارد.
نمی‌خواهی سیستم ساخت یوزر و مدیریت پسورد بسازی.

راه‌حل:

* ورود با Google فعال می‌کنی
* کاربر با یک کلیک وارد می‌شود (OAuth)

✅ نتیجه: ساده‌سازی ورود، کاهش مسئولیت نگهداری پسورد، امنیت بیشتر

---

### 3. اتصال GitLab / Jenkins / Kasm به Keycloak (OAuth Server سازمانی)

در پروژه بزرگ، سازمان یک سرور Keycloak نصب کرده که تمام احراز هویت‌ها را مدیریت می‌کند.

هر سرویسی که نیاز به ورود دارد (مثل Kasm، GitLab، Nextcloud) فقط با Keycloak چک می‌کند.

✅ نتیجه:

* فقط یکبار ورود برای همه سرویس‌ها (SSO: Single Sign-On)
* کاربران با یک اکانت به همه سیستم‌ها دسترسی دارند.

---

## ✅ مزایای اتصال Kasm به LDAP یا OAuth

| مزیت                  | توضیح                                             |
| --------------------- | ------------------------------------------------- |
| 👤 SSO (ورود یکپارچه) | یکبار لاگین برای تمام سیستم‌ها                    |
| 🔒 امنیت بالا         | رمزنگاری، مدیریت سطح دسترسی از یک نقطه            |
| 🛠 مدیریت مرکزی       | اضافه/حذف کاربر فقط در LDAP یا OAuth انجام می‌شود |
| 📈 مقیاس‌پذیر         | در پروژه‌های بزرگ لازم است                        |
| ⏱ صرفه‌جویی در زمان   | نیازی نیست در هر سیستم مجزا یوزر بسازی            |

---

# 📌 نکته مهم برای پیاده‌سازی

اگر در حال حاضر در پروژه‌ات نیاز به یکی از موارد زیر داری:

* چند سرویس با کاربران مشترک
* کاهش مدیریت یوزرها در سرویس‌هایی مثل Kasm، GitLab، Nextcloud
* یا ورود با Google/GitHub در پروژه ابری

در این صورت اتصال به **LDAP یا OAuth** می‌تواند ساختار را امن‌تر و حرفه‌ای‌تر کند.


# LDAP DataBase

برای نگهداری مشخصات کاربران به سبک **LDAP**، نیازی به دیتابیس‌های سنتی مانند PostgreSQL یا MySQL نیست، بلکه LDAP خودش یک **دیتابیس ساختاریافته مخصوص دایرکتوری** دارد که ساختار آن بر پایه‌ی **درخت سلسله‌مراتبی** (tree-based) طراحی شده است.

با این حال، در پشت‌صحنه، **LDAP Server** برای ذخیره‌سازی اطلاعات کاربران از یک موتور پایگاه داده استفاده می‌کند که بسته به نوع سرور LDAP متفاوت است.

---


برای استفاده از LDAP به‌صورت کامل، کافی است یک **LDAP Server** نصب و راه‌اندازی شود؛ این سرور خودش دارای یک **موتور دیتابیس درونی** است که اطلاعات کاربران را به شکل درختی ذخیره می‌کند.

---

## 📌 انواع دیتابیس‌های مورد استفاده در LDAP

### ۱. **OpenLDAP** (لینوکس - رایگان و متن‌باز)

| اجزا              | توضیح                                       |
| ----------------- | ------------------------------------------- |
| slapd             | سرویس اصلی LDAP سرور                        |
| دیتابیس پیش‌فرض   | `mdb` یا `hdb` یا `bdb` (نسخه‌های قدیمی‌تر) |
| ساختار ذخیره‌سازی | درختی، مانند فایل‌سیستم                     |
| محل دیتابیس       | معمولاً در `/var/lib/ldap`                  |

✅ پشتیبانی از انواع backendها:

* `mdb` (Lightning Memory-Mapped Database) — سریع‌ترین و پایدارترین
* `hdb` (Hierarchical DB) — ساختار سلسله‌مراتبی
* `bdb` (Berkeley DB) — در نسخه‌های قدیمی‌تر

---

### ۲. **Microsoft Active Directory** (LDAP + ویژگی‌های خاص)

| توضیح                                                   |
| ------------------------------------------------------- |
| دیتابیس داخلی خودش را دارد، به نام `NTDS.dit`           |
| محل ذخیره در ویندوز سرور: `C:\Windows\NTDS\ntds.dit`    |
| ساختار آن بر پایه‌ی Extensible Storage Engine (ESE) است |
| با پروتکل LDAP سازگار است                               |

---

### ۳. **Apache Directory Server**

* دیتابیس داخلی مبتنی بر Java و OSGi
* با LDAP کاملاً سازگار
* قابل سفارشی‌سازی برای پروژه‌های Java-based

---

## 🗂 ساختار داده‌ها در LDAP

LDAP از یک ساختار درختی استفاده می‌کند. هر گره یا رکورد، به‌صورت یک **entry** ذخیره می‌شود که شامل **attribute**‌ها است. مثل:

```
dn: uid=saeed,ou=users,dc=example,dc=com
objectClass: inetOrgPerson
uid: saeed
cn: Saeed Karimi
sn: Karimi
mail: saeed@example.com
userPassword: {SHA}hashedpassword
```

---

## ✅ نتیجه‌گیری (برای استفاده عملی):

| اگر از           | استفاده می‌کنی | دیتابیس داخلی چیست؟           |
| ---------------- | -------------- | ----------------------------- |
| OpenLDAP         | روی لینوکس     | mdb یا hdb در `/var/lib/ldap` |
| Active Directory | روی ویندوز     | ntds.dit                      |
| ApacheDS         | روی Java       | داخلی و OSGi-based            |

پس:

* نیازی به نصب PostgreSQL/MySQL نیست
* اطلاعات به‌صورت **درختی و سلسله‌مراتبی** در دیتابیس داخلی سرور LDAP ذخیره می‌شوند
* مدیریت با ابزارهایی مثل `ldapadd`, `ldapsearch`, `phpLDAPadmin`, یا `Apache Directory Studio` انجام می‌شود

---

