#### **تعریف و کاربرد ctop**
`ctop` یک ابزار متن‌محور (TUI - Text-based User Interface) است که به شما امکان نظارت بر کانتینرها و سرویس‌های داکر را می‌دهد. این ابزار شبیه به `htop` برای فرآیندهای سیستم عمل می‌کند و اطلاعات زنده از منابع سیستمی (CPU، حافظه، شبکه و دیسک) هر کانتینر را نمایش می‌دهد. این ابزار برای مدیریت سریع و دقیق کانتینرها بسیار مفید است.

**کاربردهای اصلی:**
- نظارت بر وضعیت کانتینرها (فعال، متوقف، خطا).
- مشاهده مصرف منابع سیستمی (CPU، RAM، شبکه و دیسک).
- مرتب‌سازی و فیلتر کردن کانتینرها بر اساس معیارهای مختلف.
- دسترسی سریع به لاگ‌های کانتینرها.
- مدیریت ساده کانتینرها (استارت، استاپ، حذف).

---

#### **نحوه نصب**

##### **1. نیازمندی‌ها:**
- **Docker**: ابتدا باید Docker روی سیستم شما نصب باشد. اگر Docker نصب نیست، می‌توانید آن را از [این لینک](https://docs.docker.com/get-docker/) نصب کنید.
- **دسترسی به اینترنت**: برای دانلود فایل‌های نصب.
- **مجوزهای root**: برای قرار دادن فایل در مسیرهای سیستمی.

##### **2. دستورات نصب:**

###### **روش اول: دانلود مستقیم باینری**
```bash
sudo wget https://github.com/bcicen/ctop/releases/download/v0.7.7/ctop-0.7.7-linux-amd64 -O /usr/local/bin/ctop
sudo chmod +x /usr/local/bin/ctop
```

###### **روش دوم: استفاده از Docker**
اگر نمی‌خواهید ctop را مستقیماً روی سیستم نصب کنید، می‌توانید از یک کانتینر Docker استفاده کنید:
```bash
docker run --rm -ti \
  --name=ctop \
  -v /var/run/docker.sock:/var/run/docker.sock \
  quay.io/vektorlab/ctop:latest
```

###### **روش سوم: نصب از طریق Snap**
اگر Snap روی سیستم شما نصب است، می‌توانید از دستور زیر استفاده کنید:
```bash
sudo snap install ctop
```

---

#### **نحوه تعامل**

##### **اجرا:**
بعد از نصب، می‌توانید ctop را با دستور زیر اجرا کنید:
```bash
ctop
```

##### **صفحه اصلی:**
در صفحه اصلی، لیست تمام کانتینرهای فعال و متوقف نمایش داده می‌شود. هر ردیف شامل اطلاعات زیر است:
- **ID**: شناسه کانتینر.
- **NAME**: نام کانتینر.
- **STATUS**: وضعیت کانتینر (فعال، متوقف، خطا).
- **CPU**: درصد استفاده از CPU.
- **MEM**: مقدار حافظه استفاده‌شده.
- **NET**: ترافیک شبکه.
- **IO**: عملیات I/O دیسک.

##### **دستورات کلیدی:**
در حالت اجرا، می‌توانید از کلیدهای زیر برای تعامل با ctop استفاده کنید:

| کلید           | عملکرد                                                                 |
|----------------|------------------------------------------------------------------------|
| `F`:           | فیلتر کردن کانتینرها بر اساس نام یا ID.                               |
| `S`:           | مرتب‌سازی کانتینرها بر اساس معیارهای مختلف (CPU, MEM, NET).           |
| `Enter`:       | مشاهده جزئیات یک کانتینر خاص (مانند لاگ‌ها و وضعیت شبکه).             |
| `a`:           | نمایش کانتینرهای فعال یا تمام کانتینرها (فعال + متوقف).               |
| `H`:           | تغییر واحد نمایش حافظه (بایت، کیلوبایت، مگابایت).                    |
| `q`:           | خروج از ctop.                                                         |

---

#### **تنظیمات و کانفیگ**

##### **1. تنظیمات پیش‌فرض:**
ctop تنظیمات پیش‌فرض خود را از فایل زیر می‌خواند:
```
~/.config/ctop/config.toml
```
اگر این فایل وجود نداشته باشد، ctop از تنظیمات پیش‌فرض استفاده می‌کند.

##### **2. مثال تنظیمات سفارشی:**
برای ایجاد یک فایل تنظیمات سفارشی، می‌توانید فایل `config.toml` را با محتوای زیر ایجاد کنید:
```toml
[ui]
refresh_rate = 5  # نرخ تازه‌سازی صفحه (ثانیه)

[docker]
socket = "/var/run/docker.sock"  # محل سوکت Docker

[display]
memory_unit = "mb"  # واحد نمایش حافظه (b, kb, mb, gb)
```

##### **3. ذخیره تنظیمات:**
فایل `config.toml` را در مسیر `~/.config/ctop/` ذخیره کنید. اگر این مسیر وجود ندارد، آن را ایجاد کنید:
```bash
mkdir -p ~/.config/ctop/
nano ~/.config/ctop/config.toml
```

---

#### **نکات مهم**

1. **دسترسی به Docker Socket:**
   - ctop نیاز به دسترسی به سوکت Docker (`/var/run/docker.sock`) دارد. اطمینان حاصل کنید که کاربر فعلی دسترسی خواندن و نوشتن به این فایل را دارد.
   - اگر از Docker Desktop استفاده می‌کنید، ممکن است نیاز به اجرای ctop با دسترسی `sudo` داشته باشید.

2. **به‌روزرسانی:**
   - برای به‌روزرسانی ctop، می‌توانید فایل باینری را دوباره دانلود کنید یا از Docker استفاده کنید.

3. **اجرای دوره‌ای:**
   - اگر می‌خواهید ctop به‌صورت دوره‌ای اجرا شود، می‌توانید از یک cron job استفاده کنید:
     ```bash
     * * * * * /usr/local/bin/ctop > /path/to/logs/ctop.log
     ```
